TASK_NAME: coco512-Retinanet-Res50
SAVE_DIR: runs
RESUME: True
SEED: 1024
PORT: 13333
VERBOSE: False
DATA_READER: MemcachedReader  # CephReader

PRIORS: &p
  MIN_SIZES: [32, 64, 128, 256, 512]
  ASPECT_RATIOS: [[1, 2, 0.5], [1, 2, 0.5], [1, 2, 0.5], [1, 2, 0.5], [1, 2, 0.5]]
  SCALE_RATIO: &s [1, 1.259921, 1.587401] # 1, 2^(1/3), 2^(2/3)
  SCALE_RATIOS: [*s, *s, *s, *s, *s]
  VARIANCES: [1, 1]
  MATCH_THRESHOLD: [0.4, 0.5] # lower and upper threshold for gt & prior matching, ignored if iou is in between
  CLIP: False

MODEL:
  TYPE: Retina
  IMAGE_SIZE: 512
  BASE: resnet50()
  EXTRA: fpn_extra_wrapper(output_channels=[256, 256], batch_norm=False, relu=False)
  HEADS: conv_stack_head_wrapper(interc=[256, 256, 256, 256], bn=False)

TRAIN:
  PRETRAIN: /mnt/lustre/share/fundamental-support/models/alphatrion/resnet50.pth
  CEPH_PRETRAIN: s3://parrots_data/fundamental-support/models/alphatrion/resnet50.pth
  BATCH_SIZE: 32

LOSS:
  TYPE: cefocal_smoothl1 # cefocal/ bcefocal/ multibox
  ALPHA: 0.25
  GAMMA: 2
  LOCALIZATION_WEIGHT: 1.0 # weight factor for localization loss

VALID:
  EPOCH: 2
  BATCH_SIZE: 16
  TOP_K: 100
  NMS_CONF: 0.05 # used in nms
  NMS_IOU: 0.5 # used in nms
  VAL_IOU: [0.5, 0.55, 0.6, 0.65, 0.7, 0.75, 0.8, 0.85, 0.9, 0.95]
  CLS_PREACT: Softmax(dim=-1)

SOLVER:
  TYPE: SGD
  LR: 0.04
  LR_POLICY: step
  LR_DECAY: 0.1
  LR_STEPS: [10, 13]
  LR_WARMUP_STEP: 1
  FREEZE_LAYERS: ['base.conv1', 'base.bn1', 'base.layer1']
  CLIP_GRAD: 10
  MOMENTUM: 0.9
  WEIGHT_DECAY: 0.0001
  MAX_EPOCH: 14
BN:
  FREEZE: True

DATA:
  NUM_CLASSES: 80
  NUM_WORKERS: 4
  TRAIN:
    ANNOTATION: datalist/coco_train2017.txt
    ROOT: /mnt/lustre/DATAshare/detection_dataset/coco2017
    CEPH_ROOT: s3://parrots_data/DSK/datasets/mscoco2017
    AUGMENTATION: RetinaAugmentationFixSizeTrain
  VALID:
    ANNOTATION: datalist/coco_val2017.txt
    ROOT: /mnt/lustre/DATAshare/detection_dataset/coco2017
    CEPH_ROOT: s3://parrots_data/DSK/datasets/mscoco2017
    AUGMENTATION: RetinaAugmentationFixSizeVal

RECORD:
  TENSOR_BOARD: True
  CKPT: 2
  WINDOW_SIZE: 20
  PLAIN_FREQ: 20 # steps to record on the screen output
  CURVE_FREQ: 20 # steps to record on tensorboard

PAVI:
  USE: False
  WRITER:
      TASK: 'ssd_Retina_pat'
