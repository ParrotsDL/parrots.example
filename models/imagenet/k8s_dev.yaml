apiVersion: v1
kind: Pod
metadata:
  name: parrots-wq4-dev
  namespace: parrots
spec:
  volumes:
    - name: dev
      hostPath:
        path: /dev
    - name: memcached-server
      hostPath:
        path: /mnt/lustre/share/memcached_client/server_list.conf
    - name: memcached-client
      hostPath:
        path: /mnt/lustre/share/memcached_client/client.conf
    - name: imagenet
      hostPath:
        path: /mnt/lustre/share/images
    - name: working-dir
      hostPath:
        path: /mnt/lustre/wangqian4
  containers:
    - name: parrots
      image: registry.sensetime.com/parrots/parrots:dev
      workingDir: /mnt/lustre/wangqian4/
      command: ["sleep"]
      args: ["100000000"]
      # stdin: true
      # tty: true
      securityContext:
        capabilities:
          add: ["IPC_LOCK"]
      env:
        - name: NVIDIA_DRIVER_CAPABILITIES
          value: "compute,utility"
        - name: NVIDIA_REQUIRE_CUDA
          value: "cuda>=8.0"
        - name: MV2_ENABLE_AFFINITY
          value: "0"
      resources:
        limits:
          nvidia.com/gpu: 8
          rdma/hca: 1 # requesting 1 RDMA device
          cpu: 16
          memory: "128Gi"
      volumeMounts:
        - mountPath: /dev/shm
          subPath: shm
          name: dev
        - mountPath: /mnt/lustre/share/images
          name: imagenet
        - mountPath: /mnt/lustre/share/memcached_client/server_list.conf
          name: memcached-server
        - mountPath: /mnt/lustre/share/memcached_client/client.conf
          name: memcached-client
        - mountPath: /mnt/lustre/wangqian4/
          name: working-dir